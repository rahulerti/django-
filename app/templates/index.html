<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test</title>
</head>
<body>
    <input type="text" class="in" placeholder="Name">
    <input type="password" class="pass" placeholder="Password">
    <input type="file" class="file" placeholder="Add File">
    <button class="btn">Submit</button>
    <a href="/go/app/templates/login.html">Login</a>

    <script>
        // Function to get the CSRF token from cookies
        function getCSRFToken() {
            const csrfToken = document.cookie.match(/csrftoken=([\w-]+)/);
            return csrfToken ? csrfToken[1] : '';
        }

        document.addEventListener("DOMContentLoaded", function() {
            // Get the CSRF token from the cookie
            const csrfToken = getCSRFToken(); 

            document.querySelector('.btn').addEventListener('click', () => {
                const name = document.querySelector('.in').value;
                const password = document.querySelector('.pass').value;
                const file = document.querySelector('.file').files[0];

                // Create a FormData object to hold the file and other data
                const formData = new FormData();
                formData.append('name', name);
                formData.append('password', password);
                formData.append('file', file);

                fetch('http://127.0.0.1:8000/save_use/', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': csrfToken  // Include CSRF token from cookies
                    },
                    body: formData  // Send the FormData object as the request body
                })
                .then(response => response.json())
                .then(data => {
                    alert('Success: ' + data.message);
                })
                .catch((error) => {
                    alert('Error: ' + error);
                });
            });
        });
    </script>

</body>
</html>
